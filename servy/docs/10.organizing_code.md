# Organizing Code

## ê°•ì˜ ì£¼ìš” ë‚´ìš©

* module ë¶„ë¦¬ ë°©ë²•
* import ì‚¬ìš©ë²•
* ì ˆëŒ€ê²½ë¡œ ì¹˜í™˜ë°©ë²•

### 1. module ë¶„ë¦¬ ë°©ë²•

```elixir
defmodule Servy.Handler do
Â  @moduledoc """
Â  Handles HTTP requests
Â  """  

Â  @pages_path Path.expand("pages", File.cwd!) 

  @doc """
Â  Transforms the request into a respond
Â  """
Â  def handle(request) do
Â  Â  request
Â  Â  |> parse
Â  Â  ## ë¶„ë¦¬ëœ ëª¨ë“ˆ ì‚¬ìš©ì‹œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤.í•¨ìˆ˜ëª… í˜•íƒœë¡œ ì‚¬ìš©í•œë‹¤.
Â  Â  |> Servy.Plugins.rewrite_path
Â  Â  |> Servy.Plugins.log
Â  Â  |> route
Â  Â  |> Servy.Plugins.track
Â  Â  #|> emojify
Â  Â  |> format_response
Â  end

  ...
  ...
end



## ë¶„ë¦¬ëœ plugins ëª¨ë“ˆ
require Logger  

defmodule Servy.Plugins do
Â  def emojify(%{status: 200} = conv) do
Â  Â  emojies = String.duplicate("ğŸ‰", 5)
Â  Â  body = emojies <> "\n" <> conv.resp_body <> "\n" <> emojies
Â  Â  %{conv | resp_body: body}
Â  end 

Â  def emojify(conv), do: conv
Â  @doc """
Â  Logs for 404 requests
Â  """
Â  def track(%{status: 404, path: path} = conv) do
Â  Â  Logger.warning "Warning: #{path} is on then loose"
Â  Â  conv
Â  end 

Â  def track(conv), do: conv  

Â  def rewrite_path(%{path: "/wildlife"} = conv) do
Â  Â  %{ conv | path: "/wildthings" }
Â  end 

Â  def rewrite_path(%{path: "/bears?id" <> id} = conv) do
Â  Â  %{ conv | path: "/bears/#{id}" }
Â  end 

Â  def rewrite_path(conv), do: conv 

Â  def log(conv), do: IO.inspect conv
end
```


### 2. import ì‚¬ìš©ë²•


```elixir

defmodule Servy.Handler do
Â  @moduledoc """
Â  Handles HTTP requests
Â  """  

Â  @pages_path Path.expand("pages", File.cwd!) 

  ## ëª¨ë“ˆì„ ì„í¬íŠ¸ í•œë‹¤.
  ## ì´ê²½ìš° ì „ì²´ ëª¨ë“ˆì„ import í•˜ê²Œ ëœë‹¤.
  #import Servy.Plugins
  
  ## íŠ¹ì • í•¨ìˆ˜ë§Œ ì„í¬íŠ¸ í•˜ê³ ì í•˜ë©´, only í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ê³ , ë’¤ì— ìˆ«ìëŠ” arity ì´ë‹¤.
Â  import Servy.Plugins, only: [rewrite_path: 1, log: 1, track: 1]
Â  
  @doc """
Â  Transforms the request into a respond
Â  """
Â  def handle(request) do
Â  Â  request
Â  Â  |> parse
Â  Â  ## importë¥¼ í†µí•´ ì²˜ë¦¬ëœ í•¨ìˆ˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì—†ì´ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤
Â  Â  |> rewrite_path
Â  Â  |> log
Â  Â  |> route
Â  Â  |> track
Â  Â  #|> emojify
Â  Â  |> format_response
Â  end

  ...
  ...
end
```

### 3. ì ˆëŒ€ê²½ë¡œ ì¹˜í™˜ë°©ë²•

```elixir
## ê¸°ì¡´ë°©ë²•
@pages_path Path.expand("../../pages", __DIR__)

## ìƒˆë¡œìš´ ë°©ë²•
@pages_path Path.expand("pages", File.cwd!)
```

* í˜„ì¬ ë””ë ‰í† ë¦¬ë¶€í„° pages ë””ë ‰í† ë¦¬ë¥¼ ì°¾ëŠ”ë‹¤.
* mix í”„ë¡œì íŠ¸ëŠ” root ë””ë ‰í† ë¦¬ì—ì„œë§Œ ì‹¤í–‰ì´ ë˜ê¸° ë•Œë¬¸ì—, ì‹¤í–‰ ê²½ë¡œì— ë”°ë¼ pagesë¥¼ ëª»ì°¾ëŠ” ê±±ì •ì€ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
* ì¶”ê°€ë¡œ elixir í•¨ìˆ˜ëª… ë’¤ì˜ `ëŠë‚Œí‘œ(!)`ëŠ” ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤ëŠ” ëœ»ì´ë‹¤.