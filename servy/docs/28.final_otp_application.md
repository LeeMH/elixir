# Final OTP Application

## ê°•ì˜ ì£¼ìš” ë‚´ìš©

* mix ì½˜ì†” ëª…ë ¹ì–´, iex -S mix ë¹„êµ
* Application  ëª¨ë“ˆ ì„¤ëª… ë° ì»´íŒŒì¼ëœ ëª¨ë“ˆ ìœ„ì¹˜
* Applicaiton ìë™ ê¸°ë™
* í™˜ê²½ë³€ìˆ˜ ì„¤ì • ë°©ë²•
* mix project ìƒì„± tip

### 1. mix ì½˜ì†” ëª…ë ¹ì–´, iex -S mix ë¹„êµ

* mix clean + mix compile +mix run --no-halt = `iex -S mix` = `ì „ì²´ ì»´íŒŒì¼ + Application ê¸°ë™`

### 2. Application  ëª¨ë“ˆ ì„¤ëª… ë° ì»´íŒŒì¼ëœ ëª¨ë“ˆ ìœ„ì¹˜

```elixir
## ê¸°ë™ëœ applicaiton í™•ì¸
iex(1)> Application.started_applications()
[
  {:iex, ~c"iex", ~c"1.15.7"},
  {:servy, ~c"servy", ~c"0.1.0"},
  {:poison, ~c"An incredibly fast, pure Elixir JSON library", ~c"4.0.1"},
  {:logger, ~c"logger", ~c"1.15.7"},
  {:hex, ~c"hex", ~c"2.0.6"},
  {:inets, ~c"INETS  CXC 138 49", ~c"9.1"},
  {:ssl, ~c"Erlang/OTP SSL application", ~c"11.1.2"},
  {:public_key, ~c"Public key infrastructure", ~c"1.15.1"},
  {:asn1, ~c"The Erlang ASN1 compiler version 5.2.1", ~c"5.2.1"},
  {:crypto, ~c"CRYPTO", ~c"5.4.1"},
  {:mix, ~c"mix", ~c"1.15.7"},
  {:elixir, ~c"elixir", ~c"1.15.7"},
  {:compiler, ~c"ERTS  CXC 138 10", ~c"8.4.2"},
  {:stdlib, ~c"ERTS  CXC 138 10", ~c"5.2.1"},
  {:kernel, ~c"ERTS  CXC 138 10", ~c"9.2.2"}
]
```


```bash
## í”„ë¡œì íŠ¸ í´ë”/_build/dev/lib/í”„ë¡œì íŠ¸ëª…/ebinì— ì»´íŒŒì¼ëœ ëª¨ë“ˆì„ ë³¼ìˆ˜ ìˆë‹¤.
$ ls _build/dev/lib/servy/ebin/
Elixir.Servy.Api.BearController.beam  Elixir.Servy.Handler.beam             Elixir.Servy.PledgeServer.beam            Elixir.Servy.Tracker.beam
Elixir.Servy.Bear.beam                Elixir.Servy.HttpServer.beam          Elixir.Servy.PledgeServerHandRolled.beam  Elixir.Servy.VideoCam.beam
Elixir.Servy.BearController.beam      Elixir.Servy.KickStarter.beam         Elixir.Servy.Plugins.beam                 Elixir.Servy.Wildthings.beam
Elixir.Servy.Conv.beam                Elixir.Servy.Parser.beam              Elixir.Servy.SensorServer.beam            servy.app
Elixir.Servy.Fetcher.beam             Elixir.Servy.PledgeController.beam    Elixir.Servy.ServicesSupervisor.beam
Elixir.Servy.GenericServer.beam       Elixir.Servy.PledgeServer.State.beam  Elixir.Servy.Supervisor.beam

## í”„ë¡œì íŠ¸ëª….app ì—ëŠ” í”„ë¡œì íŠ¸ì— ê´€ë ¨ëœ ì •ë³´ì™€ ëª¨ë“ˆì •ë³´ê°€ ê¸°ë¡ëœë‹¤.
$ cat build/dev/lib/servy/ebin/servy.app 
{application,servy,
             [{optional_applications,[]},
              {applications,[kernel,stdlib,elixir,logger,poison]},
              {description,"servy"},
              {modules,['Elixir.Servy.Api.BearController','Elixir.Servy.Bear',
                        'Elixir.Servy.BearController','Elixir.Servy.Conv',
                        'Elixir.Servy.Fetcher','Elixir.Servy.GenericServer',
                        'Elixir.Servy.Handler','Elixir.Servy.HttpServer',
                        'Elixir.Servy.KickStarter','Elixir.Servy.Parser',
                        'Elixir.Servy.PledgeController',
                        'Elixir.Servy.PledgeServer',
                        'Elixir.Servy.PledgeServer.State',
                        'Elixir.Servy.PledgeServerHandRolled',
                        'Elixir.Servy.Plugins','Elixir.Servy.SensorServer',
                        'Elixir.Servy.ServicesSupervisor',
                        'Elixir.Servy.Supervisor','Elixir.Servy.Tracker',
                        'Elixir.Servy.VideoCam','Elixir.Servy.Wildthings']},
              {registered,[]},
              {vsn,"0.1.0"}]}.
```

### 3. Application  ìë™ ê¸°ë™

* Application ëª¨ë“ˆì„ ì¶”ê°€ í•˜ê³ ,
```elixir
defmodule Servy do
Â  use Application  

Â  def start(_type, _args) do
Â  Â  IO.puts "Starting the application..."
Â  Â  ## application êµ¬ë™ì‹œ í•„ìš”í•œ, supervisorë“±ì„ êµ¬ë™í•œë‹¤.
Â  Â  Servy.Supervisor.start_link()
Â  end
end
```

* mix.exs ì„¤ì •ì— ì•„ë˜ì™€ ê°™ì´ ì„¤ì •ì„ ì¶”ê°€í•œë‹¤.
```elixir
Â  # Run "mix help compile.app" to learn about applications.
Â  def application do
Â  Â  [
Â  Â  Â  extra_applications: [:logger],
Â  Â  Â  # ì—¬ê¸°ì— ëª…ì‹œí•˜ë©´, application ê¸°ë™ì‹œ ìë™ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.
Â  Â  Â  mod: {Servy, []},
Â  Â  ]
Â  end
```


### 4. í™˜ê²½ë³€ìˆ˜ ì„¤ì • ë°©ë²•

* mix.exsì— í™˜ê²½ë³€ìˆ˜ë¥¼ ì¶”ê°€í•œë‹¤.
```elixir
Â  # Run "mix help compile.app" to learn about applications.
Â  def application do
Â  Â  [
Â  Â  Â  extra_applications: [:logger],
Â  Â  Â  mod: {Servy, []},
Â  Â  Â  ## í™˜ê²½ë³€ìˆ˜ ì¶”ê°€, K:V í˜•íƒœë¡œ ì¶”ê°€
Â  Â  Â  env: [port: 3000]
Â  Â  ]
Â  end
```

* í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“ˆ ì½”ë“œ
```elixir
Â  defp start_server() do
Â  Â  IO.puts "Starting the HTTP server..."

    ## í™˜ê²½ë³€ìˆ˜ë¥¼ ì½ì–´ì„œ ì €ì¥í•œë‹¤.
Â  Â  port = Application.get_env(:servy, :port)
Â  Â  server_pid = spawn_link(Servy.HttpServer, :start, [port])
Â  Â  Process.register(server_pid, :http_server)
Â  Â  server_pid
Â  end
```


```bash
## ëª…ë ¹í–‰ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì—¬ ê¸°ë™í•  ìˆ˜ ìˆë‹¤.
$ elixir --erl "-servy port 9000" -S mix run --no-halt
warning: unused alias VideoCam
  lib/servy/handler.ex:9

warning: default values for the optional arguments in render/3 are never used
  lib/servy/bear_controller.ex:8

Starting the application...
Starting THE supervisor...
Starting the kickstarter
Starting the HTTP server...
Starting the services supervisor...
Starting the pledge server...

ğŸ§  Listening for connection requests on port 9000...

Starting the sensor server with 60...
âŒ›ï¸  Waiting to accept a client connection...

Running tasks to get sensor data...
```

### 5. mix project ìƒì„± tip

* mix í”„ë¡œì íŠ¸ ìƒì„±ì‹œ `sup ì˜µì…˜`ì„ ì¶”ê°€í•˜ë©´, supervisorë¥¼ êµ¬ë™í•˜ëŠ” ì†ŒìŠ¤ë¥¼ ìƒì„±í•´ ì¤€ë‹¤.
```bash
mix new slurpie --sup
```

* Supervisor ëª¨ë“ˆ ì—­í• ì„ applicationì—ì„œ ìˆ˜í–‰í•œë‹¤.
```elixir
defmodule Slurpie.Application do

  use Application

  def start(_type, _args) do
    children = [
      # Starts a worker by calling: Slurpie.Worker.start_link(arg)
      # {Slurpie.Worker, arg},
    ]

    opts = [strategy: :one_for_one, name: Slurpie.Supervisor]
    Supervisor.start_link(children, opts)
  end
end
```

* ë˜í•œ, mix.exsì— mod ì„¤ì •ë„ ìë™ìœ¼ë¡œ ì¶”ê°€ëœë‹¤.
```elixir
def application do
  [
    # ...
    mod: {Slurpie.Application, []}
  ]
end
```